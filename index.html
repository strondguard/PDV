<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema PDV - Barraquinha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Adicionando a biblioteca jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Estilos personalizados */
        .table-active {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .receipt-item:hover {
            background-color: #f3f4f6;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .sidebar {
            transition: width 0.3s ease-in-out;
            width: 70px; /* Colapsada por padrão em mobile */
            overflow: hidden;
        }
        .sidebar.collapsed {
            width: 70px;
        }
        .sidebar.expanded {
            width: 256px; /* Expandida */
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        .sidebar.expanded .sidebar-text {
            display: block;
        }
        /* Em telas maiores, a sidebar expande por padrão */
        @media (min-width: 768px) {
            .sidebar {
                width: 256px; /* Expandida por padrão em desktop */
            }
            .sidebar.collapsed {
                width: 70px;
            }
            .sidebar.collapsed .sidebar-text {
                display: none;
            }
        }

        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
            flex-grow: 1;
            text-align: center;
        }
        .tab-button.active {
            background-color: #2563eb;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Login Modal (Inicial) -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Login</h2>
            <form id="loginForm">
                <div class="mb-4">
                    <label for="username" class="block text-gray-700 text-sm font-bold mb-2">Usuário</label>
                    <input id="username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" type="text" placeholder="Digite seu usuário" required>
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                    <input id="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" type="password" placeholder="********" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="flex flex-col md:flex-row h-screen overflow-y-auto md:overflow-hidden hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-blue-800 text-white flex-shrink-0 flex flex-col">
            <div class="p-4 flex items-center justify-between border-b border-blue-700">
                <h1 class="text-xl font-bold sidebar-text whitespace-nowrap">Barraquinha PDV</h1>
                <button id="toggleSidebar" class="text-white hover:text-blue-200 p-1 rounded-full md:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <!-- Botão de toggle para desktop -->
                <button id="toggleSidebarDesktop" class="text-white hover:text-blue-200 p-1 rounded-full hidden md:block">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
            </div>
            <nav class="flex-1 overflow-y-auto">
                <div class="p-2">
                    <button id="navMesas" class="flex items-center w-full p-3 rounded-lg hover:bg-blue-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 17a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM17 5a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5z" />
                        </svg>
                        <span class="ml-3 sidebar-text">Mesas</span>
                    </button>
                    <button id="navAdmin" class="flex items-center w-full p-3 rounded-lg hover:bg-blue-700 mt-1 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        <span class="ml-3 sidebar-text">Administração</span>
                    </button>
                </div>
            </nav>
            <div class="p-4 border-t border-blue-700">
                <div class="flex items-center">
                    <div class="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center">
                        <span id="userAvatar" class="text-white font-bold">AD</span>
                    </div>
                    <div class="ml-3 sidebar-text">
                        <p id="userNameDisplay" class="text-sm font-medium">Admin</p>
                        <p class="text-xs text-blue-200">Sessão iniciada</p>
                    </div>
                </div>
                <button id="sidebarLogout" class="mt-2 w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg sidebar-text">
                    Sair
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto p-4">
            <!-- Mesas View -->
            <div id="mesasView">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 sm:mb-0">Mesas</h2>
                    <div class="w-full sm:w-auto">
                        <button id="addTable" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Nova Mesa
                        </button>
                    </div>
                </div>

                <div id="tablesGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- Tables will be dynamically added here -->
                </div>
            </div>

            <!-- Admin View -->
            <div id="adminView" class="hidden">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 sm:mb-0">Painel Administrativo</h2>
                </div>

                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 mb-6 border-b pb-2">
                    <button id="adminProductsTab" class="tab-button active">Produtos</button>
                    <button id="adminTablesTab" class="tab-button">Mesas</button>
                    <button id="adminFinanceTab" class="tab-button">Financeiro</button>
                    <button id="adminUsersTab" class="tab-button">Usuários</button>
                </div>

                <!-- Products Tab -->
                <div id="productsTabContent" class="tab-content">
                    <div class="flex justify-end mb-4">
                        <button id="addProductButton" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Adicionar Produto
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Products will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tables Tab -->
                <div id="tablesTabContent" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Número</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tablesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Tables will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Finance Tab -->
                <div id="financeTabContent" class="tab-content hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 space-y-4 sm:space-y-0">
                        <div class="w-full sm:w-auto flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                            <div>
                                <label for="dateStartFilter" class="block text-sm font-medium text-gray-700">Data Inicial:</label>
                                <input type="date" id="dateStartFilter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="dateEndFilter" class="block text-sm font-medium text-gray-700">Data Final:</label>
                                <input type="date" id="dateEndFilter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex w-full sm:w-auto space-x-2">
                            <button id="applyDateFilter" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                                Buscar
                            </button>
                            <button id="resetDateFilter" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded">
                                Limpar Filtro
                            </button>
                            <button id="generatePDF" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                                Gerar PDF
                            </button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data/Hora</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mesa</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Itens</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subtotal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Desconto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serviço (10%)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Final</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Sales will be added here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-4 bg-gray-100 rounded-lg">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Total do Período:</span>
                            <span id="periodTotal" class="font-bold text-lg text-blue-600">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="font-medium">Total de Descontos:</span>
                            <span id="periodDiscountTotal" class="font-bold text-lg text-blue-600">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="font-medium">Total de Serviço (10%):</span>
                            <span id="periodServiceChargeTotal" class="font-bold text-lg text-blue-600">R$ 0,00</span>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="usersTabContent" class="tab-content hidden">
                    <div class="flex justify-end mb-4">
                        <button id="addUserButton" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Adicionar Usuário
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuário</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Product Modal -->
                <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Adicionar Produto</h3>
                            <button id="closeProductModal" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <form id="productForm">
                            <div class="mb-4">
                                <label for="productName" class="block text-gray-700 text-sm font-bold mb-2">Nome do Produto</label>
                                <input type="text" id="productName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-4">
                                <label for="productCategory" class="block text-gray-700 text-sm font-bold mb-2">Categoria</label>
                                <input type="text" id="productCategory" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-4">
                                <label for="productPrice" class="block text-gray-700 text-sm font-bold mb-2">Preço</label>
                                <input type="number" step="0.01" min="0" id="productPrice" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 mt-4">
                                <button type="button" id="cancelProduct" class="w-full sm:w-auto bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                                    Cancelar
                                </button>
                                <button type="submit" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                                    Salvar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Add User Modal -->
                <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Adicionar Usuário</h3>
                            <button id="closeUserModal" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <form id="userForm">
                            <div class="mb-4">
                                <label for="newUsername" class="block text-gray-700 text-sm font-bold mb-2">Usuário</label>
                                <input type="text" id="newUsername" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="mb-4">
                                <label for="newPassword" class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                                <input type="password" id="newPassword" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 mt-4">
                                <button type="button" id="cancelUser" class="w-full sm:w-auto bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
                                    Cancelar
                                </button>
                                <button type="submit" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                                    Salvar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Order Modal -->
            <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center border-b p-4">
                        <h3 class="text-lg font-semibold text-gray-800">Pedido - Mesa <span id="modalTableNumber">1</span></h3>
                        <button id="closeOrderModal" class="text-gray-500 hover:text-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="w-full md:w-1/2">
                                <h4 class="text-md font-semibold mb-3 text-gray-700">Adicionar Itens</h4>
                                <div class="mb-4">
                                    <input type="text" id="itemSearch" placeholder="Buscar produto..." class="w-full p-2 border rounded">
                                </div>
                                <div id="productsList" class="space-y-2 max-h-96 overflow-y-auto border rounded-lg p-2">
                                    <!-- Products will be added here -->
                                </div>
                            </div>
                            <div class="w-full md:w-1/2 mt-6 md:mt-0">
                                <h4 class="text-md font-semibold mb-3 text-gray-700">Resumo do Pedido</h4>
                                <div id="orderSummary" class="border rounded-lg p-4 mb-4 h-64 md:h-96 overflow-y-auto">
                                    <!-- Order items will be added here -->
                                </div>
                                <div class="bg-gray-100 p-4 rounded-lg">
                                    <div class="flex justify-between mb-2">
                                        <span class="font-medium">Subtotal:</span>
                                        <span id="subtotal" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span>Desconto:</span>
                                        <input type="number" id="discount" min="0" max="100" step="0.01" class="w-20 text-right" value="0"> %
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span>Serviço (10%):</span>
                                        <span id="serviceChargeAmount" class="font-medium">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between font-bold text-lg">
                                        <span>Total Final:</span>
                                        <span id="total" class="text-blue-600">R$ 0,00</span>
                                    </div>
                                    <div class="mt-4 flex items-center">
                                        <input type="checkbox" id="includeServiceCharge" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="includeServiceCharge" class="text-sm font-medium text-gray-700">Incluir 10% do Garçom</label>
                                    </div>
                                </div>
                                <div class="mt-4 flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2">
                                    <button id="cancelOrder" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded flex-1">
                                        Cancelar Pedido
                                    </button>
                                    <button id="saveOrder" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex-1">
                                        Salvar Pedido
                                    </button>
                                    <button id="checkoutOrder" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded flex-1">
                                        Finalizar Pedido
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicializa jsPDF
        const { jsPDF } = window.jspdf;
        
        // Estado da aplicação
        const state = {
            tables: JSON.parse(localStorage.getItem('tables')) || [],
            products: JSON.parse(localStorage.getItem('products')) || [
                { id: 1, name: 'Cachorro Quente', category: 'Lanches', price: 12.50 },
                { id: 2, name: 'Refrigerante', category: 'Bebidas', price: 5.00 },
                { id: 3, name: 'Porção de Batata', category: 'Acompanhamentos', price: 15.00 },
                { id: 4, name: 'Sanduíche', category: 'Lanches', price: 18.00 },
            ],
            sales: JSON.parse(localStorage.getItem('sales')) || [],
            users: JSON.parse(localStorage.getItem('users')) || [{ username: 'eddy', password: '741', role: 'admin', active: true }],
            currentUser: null,
            currentTable: null,
            currentOrder: null
        };

        // Elementos do DOM
        const elements = {
            loginModal: document.getElementById('loginModal'),
            mainApp: document.getElementById('mainApp'),
            loginForm: document.getElementById('loginForm'),
            mesasView: document.getElementById('mesasView'),
            adminView: document.getElementById('adminView'),
            navAdmin: document.getElementById('navAdmin'),
            tablesGrid: document.getElementById('tablesGrid'),
            tablesTableBody: document.getElementById('tablesTableBody'),
            productsTableBody: document.getElementById('productsTableBody'),
            salesTableBody: document.getElementById('salesTableBody'),
            usersTableBody: document.getElementById('usersTableBody'),
            productsList: document.getElementById('productsList'),
            orderSummary: document.getElementById('orderSummary'),
            orderModal: document.getElementById('orderModal'),
            addProductModal: document.getElementById('addProductModal'),
            addUserModal: document.getElementById('addUserModal'),
            sidebar: document.getElementById('sidebar'),
            subtotal: document.getElementById('subtotal'),
            total: document.getElementById('total'),
            discount: document.getElementById('discount'),
            serviceChargeAmount: document.getElementById('serviceChargeAmount'),
            includeServiceCharge: document.getElementById('includeServiceCharge'),
            productForm: document.getElementById('productForm'),
            userForm: document.getElementById('userForm'),
            itemSearch: document.getElementById('itemSearch'),
            dateStartFilter: document.getElementById('dateStartFilter'),
            dateEndFilter: document.getElementById('dateEndFilter'),
            periodTotal: document.getElementById('periodTotal'),
            periodDiscountTotal: document.getElementById('periodDiscountTotal'),
            periodServiceChargeTotal: document.getElementById('periodServiceChargeTotal'),
            adminProductsTab: document.getElementById('adminProductsTab'),
            adminTablesTab: document.getElementById('adminTablesTab'),
            adminFinanceTab: document.getElementById('adminFinanceTab'),
            adminUsersTab: document.getElementById('adminUsersTab'),
            productsTabContent: document.getElementById('productsTabContent'),
            tablesTabContent: document.getElementById('tablesTabContent'),
            financeTabContent: document.getElementById('financeTabContent'),
            usersTabContent: document.getElementById('usersTabContent'),
            generatePDF: document.getElementById('generatePDF'),
            userNameDisplay: document.getElementById('userNameDisplay'),
            userAvatar: document.getElementById('userAvatar')
        };

        // Verificar se há usuário logado no localStorage ao carregar a página
        const storedUser = localStorage.getItem('currentUser');
        if (storedUser) {
            state.currentUser = JSON.parse(storedUser);
            if (state.currentUser.active === undefined) {
                state.currentUser.active = true;
                localStorage.setItem('currentUser', JSON.stringify(state.currentUser));
            }
            elements.loginModal.classList.add('hidden');
            elements.mainApp.classList.remove('hidden');
            elements.userNameDisplay.textContent = state.currentUser.username;
            elements.userAvatar.textContent = state.currentUser.username.substring(0, 2).toUpperCase();
            if (state.currentUser.role === 'admin') {
                elements.navAdmin.classList.remove('hidden');
            }
            initApp();
        }

        // Garantir que todos os usuários tenham o campo active
        state.users.forEach(user => {
            if (user.active === undefined) user.active = true;
        });
        saveUsersToLocalStorage();

        // Event Listeners
        elements.loginForm.addEventListener('submit', handleLogin);

        document.getElementById('navMesas').addEventListener('click', () => {
            elements.mesasView.classList.remove('hidden');
            elements.adminView.classList.add('hidden');
            if (window.innerWidth < 768) {
                elements.sidebar.classList.add('collapsed');
                elements.sidebar.classList.remove('expanded');
            }
        });

        document.getElementById('navAdmin').addEventListener('click', () => {
            elements.mesasView.classList.add('hidden');
            elements.adminView.classList.remove('hidden');
            if (window.innerWidth < 768) {
                elements.sidebar.classList.add('collapsed');
                elements.sidebar.classList.remove('expanded');
            }
        });

        document.getElementById('addTable').addEventListener('click', addTable);
        document.getElementById('sidebarLogout').addEventListener('click', handleLogout);
        document.getElementById('addProductButton').addEventListener('click', () => {
            document.getElementById('addProductModal').classList.remove('hidden');
            document.getElementById('productForm').reset();
        });
        document.getElementById('addUserButton').addEventListener('click', () => {
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('userForm').reset();
        });
        document.getElementById('closeProductModal').addEventListener('click', () => {
            document.getElementById('addProductModal').classList.add('hidden');
        });
        document.getElementById('cancelProduct').addEventListener('click', () => {
            document.getElementById('addProductModal').classList.add('hidden');
        });
        document.getElementById('closeUserModal').addEventListener('click', () => {
            document.getElementById('addUserModal').classList.add('hidden');
        });
        document.getElementById('cancelUser').addEventListener('click', () => {
            document.getElementById('addUserModal').classList.add('hidden');
        });
        document.getElementById('closeOrderModal').addEventListener('click', () => {
            document.getElementById('orderModal').classList.add('hidden');
        });
        document.getElementById('cancelOrder').addEventListener('click', cancelOrder);
        document.getElementById('saveOrder').addEventListener('click', saveOrder);
        document.getElementById('checkoutOrder').addEventListener('click', checkoutOrder);

        // Toggle sidebar para mobile e desktop
        function toggleSidebar() {
            elements.sidebar.classList.toggle('collapsed');
            elements.sidebar.classList.toggle('expanded');
            // Forçar reflow para evitar bugs de transição
            elements.sidebar.offsetHeight;
        }

        // Adicionar event listeners para os botões de toggle
        document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
        const toggleSidebarDesktop = document.getElementById('toggleSidebarDesktop');
        if (toggleSidebarDesktop) {
            toggleSidebarDesktop.addEventListener('click', toggleSidebar);
        }

        // Inicializar sidebar colapsada em mobile
        function initSidebar() {
            if (window.innerWidth < 768) {
                elements.sidebar.classList.add('collapsed');
                elements.sidebar.classList.remove('expanded');
            } else {
                elements.sidebar.classList.add('expanded');
                elements.sidebar.classList.remove('collapsed');
            }
        }

        // Chamar initSidebar ao carregar a página
        document.addEventListener('DOMContentLoaded', initSidebar);

        // Ajustar sidebar ao redimensionar a janela
        window.addEventListener('resize', () => {
            if (window.innerWidth < 768) {
                elements.sidebar.classList.add('collapsed');
                elements.sidebar.classList.remove('expanded');
            } else {
                elements.sidebar.classList.add('expanded');
                elements.sidebar.classList.remove('collapsed');
            }
        });

        elements.discount.addEventListener('input', updateOrderTotal);
        elements.includeServiceCharge.addEventListener('change', updateOrderTotal);
        elements.itemSearch.addEventListener('input', filterProducts);
        elements.dateStartFilter.addEventListener('change', filterSalesByDateRange);
        elements.dateEndFilter.addEventListener('change', filterSalesByDateRange);
        document.getElementById('applyDateFilter').addEventListener('click', filterSalesByDateRange);
        document.getElementById('resetDateFilter').addEventListener('click', resetDateFilter);
        document.getElementById('adminProductsTab').addEventListener('click', () => switchTab('products'));
        document.getElementById('adminTablesTab').addEventListener('click', () => switchTab('tables'));
        document.getElementById('adminFinanceTab').addEventListener('click', () => switchTab('finance'));
        document.getElementById('adminUsersTab').addEventListener('click', () => switchTab('users'));
        document.getElementById('generatePDF').addEventListener('click', generateSalesPDF);

        elements.productForm.addEventListener('submit', saveProduct);
        elements.userForm.addEventListener('submit', saveUser);

        // Funções de login e logout
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = state.users.find(u => u.username === username && u.password === password);
            if (user) {
                state.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                elements.loginModal.classList.add('hidden');
                elements.mainApp.classList.remove('hidden');
                elements.userNameDisplay.textContent = user.username;
                elements.userAvatar.textContent = user.username.substring(0, 2).toUpperCase();
                if (user.role === 'admin') {
                    elements.navAdmin.classList.remove('hidden');
                }
                initApp();
            } else {
                alert('Usuário ou senha incorretos!');
            }
        }

        function handleLogout() {
            state.currentUser = null;
            localStorage.removeItem('currentUser');
            elements.mainApp.classList.add('hidden');
            elements.loginModal.classList.remove('hidden');
            elements.navAdmin.classList.add('hidden');
            elements.mesasView.classList.remove('hidden');
            elements.adminView.classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Funções de inicialização
        function initApp() {
            // Definir a data atual como padrão para os filtros de data
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;

            elements.dateStartFilter.value = formattedDate;
            elements.dateEndFilter.value = formattedDate;

            renderTables();
            if (state.currentUser.role === 'admin') {
                renderProductsForAdmin();
                renderTablesForAdmin();
                renderSales();
                renderUsersForAdmin();
            }
            saveProductsToLocalStorage();
            saveTablesToLocalStorage();
            saveSalesToLocalStorage();
            saveUsersToLocalStorage();

            // Esconder botão de adicionar mesa para vendedores
            const addTableBtn = document.getElementById('addTable');
            if (addTableBtn) {
                addTableBtn.style.display = (state.currentUser.role === 'admin') ? 'flex' : 'none';
            }
        }

        // Funções da área de mesas
        function addTable() {
            const newTable = {
                id: Date.now(),
                number: state.tables.length + 1,
                status: 'available',
                order: null
            };
            state.tables.push(newTable);
            saveTablesToLocalStorage();
            renderTables();
            if (state.currentUser.role === 'admin') {
                renderTablesForAdmin();
            }
        }

        function deleteTable(tableId) {
            if (confirm('Tem certeza que deseja excluir esta mesa? Esta ação não pode ser desfeita.')) {
                state.tables = state.tables.filter(t => t.id !== tableId);
                saveTablesToLocalStorage();
                renderTables();
                renderTablesForAdmin();
                alert('Mesa excluída com sucesso!');
            }
        }

        function renderTables() {
            elements.tablesGrid.innerHTML = '';
            
            state.tables.forEach(table => {
                const tableElement = document.createElement('div');
                tableElement.className = `bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-md transition-shadow ${table.status === 'occupied' ? 'border-l-4 border-red-500' : ''}`;
                tableElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex flex-col">
                            <span class="font-bold text-lg">Mesa ${table.number}</span>
                            <span class="text-sm text-gray-500 capitalize">${table.status}</span>
                        </div>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">#${table.id}</span>
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <span class="text-sm text-gray-600">
                            ${table.status === 'occupied' ? 'Pedido em andamento' : 'Disponível'}
                        </span>
                        <button class="bg-blue-100 hover:bg-blue-200 text-blue-600 p-2 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin='round' stroke-width='2' d='M9 5l7 7-7 7' />
                            </svg>
                        </button>
                    </div>
                `;
                
                tableElement.addEventListener('click', () => openOrderModal(table));
                elements.tablesGrid.appendChild(tableElement);
            });
        }

        function renderTablesForAdmin() {
            if (!elements.tablesTableBody) return;
            
            elements.tablesTableBody.innerHTML = '';
            
            state.tables.forEach(table => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${table.number}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500 capitalize">${table.status}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="delete-table text-red-600 hover:text-red-900" data-id="${table.id}">Excluir</button>
                    </td>
                `;
                
                elements.tablesTableBody.appendChild(row);
            });
            
            document.querySelectorAll('.delete-table').forEach(button => {
                button.addEventListener('click', function() {
                    const tableId = parseInt(this.getAttribute('data-id'));
                    deleteTable(tableId);
                });
            });
        }

        function openOrderModal(table) {
            if (state.currentUser.role === 'vendedor' && !state.currentUser.active) {
                alert('Você está bloqueado e não pode abrir pedidos.');
                return;
            }
            state.currentTable = table;
            document.getElementById('modalTableNumber').textContent = table.number;
            
            state.currentOrder = table.order ? {
                ...table.order,
                serviceChargePercentage: table.order.serviceChargePercentage || 0,
                serviceChargeAmount: table.order.serviceChargeAmount || 0
            } : {
                items: [],
                subtotal: 0,
                discount: 0,
                total: 0,
                serviceChargePercentage: 10,
                serviceChargeAmount: 0,
                status: 'open'
            };

            elements.includeServiceCharge.checked = state.currentOrder.serviceChargePercentage > 0;
            elements.discount.value = state.currentOrder.discount;
            
            renderProductsForOrder();
            renderOrderSummary();
            updateOrderTotal();
            
            document.getElementById('orderModal').classList.remove('hidden');
        }

        function renderProductsForOrder() {
            elements.productsList.innerHTML = '';
            
            state.products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'bg-white border rounded-lg p-3 hover:shadow transition-shadow';
                productElement.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">${product.name}</p>
                            <p class="text-sm text-gray-500">${product.category} - R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                        </div>
                        <button class="add-to-order bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                            Adicionar
                        </button>
                    </div>
                `;
                
                productElement.querySelector('.add-to-order').addEventListener('click', () => {
                    addItemToOrder(product);
                });
                
                elements.productsList.appendChild(productElement);
            });
        }

        function filterProducts() {
            const searchTerm = elements.itemSearch.value.toLowerCase();
            const products = document.querySelectorAll('#productsList > div');
            
            products.forEach(product => {
                const name = product.querySelector('p.font-medium').textContent.toLowerCase();
                const category = product.querySelector('p.text-sm.text-gray-500').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || category.includes(searchTerm)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }

        function addItemToOrder(product) {
            const existingItemIndex = state.currentOrder.items.findIndex(item => item.productId === product.id);
            
            if (existingItemIndex !== -1) {
                state.currentOrder.items[existingItemIndex].quantity += 1;
            } else {
                state.currentOrder.items.push({
                    productId: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            
            updateOrderTotal();
            renderOrderSummary();
        }

        function renderOrderSummary() {
            elements.orderSummary.innerHTML = '';
            
            if (state.currentOrder.items.length === 0) {
                elements.orderSummary.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum item adicionado</p>';
                return;
            }
            
            state.currentOrder.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'receipt-item flex justify-between items-center py-2 px-2 border-b';
                itemElement.innerHTML = `
                    <div class="flex-1">
                        <p class="font-medium">${item.name}</p>
                        <p class="text-sm text-gray-500">R$ ${item.price.toFixed(2).replace('.', ',')} x ${item.quantity}</p>
                    </div>
                    <div class="flex items-center">
                        <span class="font-medium mr-4">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</span>
                        <button class="remove-item text-red-500 hover:text-red-700 mr-2" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                        <button class="decrease-item text-blue-500 hover:text-blue-700" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                            </svg>
                        </button>
                        <span class="quantity mx-2">${item.quantity}</span>
                        <button class="increase-item text-blue-500 hover:text-blue-700" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                        </button>
                    </div>
                `;
                
                elements.orderSummary.appendChild(itemElement);
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeItemFromOrder(index);
                });
            });
            
            document.querySelectorAll('.decrease-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    decreaseItemQuantity(index);
                });
            });
            
            document.querySelectorAll('.increase-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    increaseItemQuantity(index);
                });
            });
        }

        function removeItemFromOrder(index) {
            state.currentOrder.items.splice(index, 1);
            renderOrderSummary();
            updateOrderTotal();
        }

        function decreaseItemQuantity(index) {
            if (state.currentOrder.items[index].quantity > 1) {
                state.currentOrder.items[index].quantity -= 1;
                renderOrderSummary();
                updateOrderTotal();
            }
        }

        function increaseItemQuantity(index) {
            state.currentOrder.items[index].quantity += 1;
            renderOrderSummary();
            updateOrderTotal();
        }

        function updateOrderTotal() {
            state.currentOrder.subtotal = state.currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            state.currentOrder.discount = parseFloat(elements.discount.value) || 0;
            
            let totalAfterDiscount = state.currentOrder.subtotal - (state.currentOrder.subtotal * (state.currentOrder.discount / 100));
            
            if (elements.includeServiceCharge.checked) {
                state.currentOrder.serviceChargePercentage = 10;
                state.currentOrder.serviceChargeAmount = totalAfterDiscount * 0.10;
            } else {
                state.currentOrder.serviceChargePercentage = 0;
                state.currentOrder.serviceChargeAmount = 0;
            }

            state.currentOrder.total = totalAfterDiscount + state.currentOrder.serviceChargeAmount;
            
            elements.subtotal.textContent = `R$ ${state.currentOrder.subtotal.toFixed(2).replace('.', ',')}`;
            elements.serviceChargeAmount.textContent = `R$ ${state.currentOrder.serviceChargeAmount.toFixed(2).replace('.', ',')}`;
            elements.total.textContent = `R$ ${state.currentOrder.total.toFixed(2).replace('.', ',')}`;
        }

        function cancelOrder() {
            state.currentOrder = null;
            document.getElementById('orderModal').classList.add('hidden');
        }

        function saveOrder() {
            if (state.currentUser.role === 'vendedor' && !state.currentUser.active) {
                alert('Você está bloqueado e não pode salvar pedidos.');
                return;
            }
            const tableIndex = state.tables.findIndex(t => t.id === state.currentTable.id);
            
            if (tableIndex !== -1) {
                state.tables[tableIndex].order = state.currentOrder;
                state.tables[tableIndex].status = 'occupied';
                saveTablesToLocalStorage();
                
                renderTables();
                if (state.currentUser.role === 'admin') {
                    renderTablesForAdmin();
                }
                
                alert('Pedido salvo com sucesso!');
            }
            
            document.getElementById('orderModal').classList.add('hidden');
        }

        function checkoutOrder() {
            if (state.currentUser.role === 'vendedor' && !state.currentUser.active) {
                alert('Você está bloqueado e não pode finalizar pedidos.');
                return;
            }
            if (confirm('Deseja finalizar este pedido?')) {
                const tableIndex = state.tables.findIndex(t => t.id === state.currentTable.id);
                
                if (tableIndex !== -1) {
                    const sale = {
                        id: Date.now(),
                        date: new Date().toISOString(),
                        tableNumber: state.tables[tableIndex].number,
                        items: [...state.currentOrder.items],
                        subtotal: state.currentOrder.subtotal,
                        discount: state.currentOrder.discount,
                        serviceChargePercentage: state.currentOrder.serviceChargePercentage,
                        serviceChargeAmount: state.currentOrder.serviceChargeAmount,
                        total: state.currentOrder.total
                    };
                    state.sales.push(sale);
                    saveSalesToLocalStorage();
                    
                    state.tables[tableIndex].order = null;
                    state.tables[tableIndex].status = 'available';
                    saveTablesToLocalStorage();

                    elements.discount.value = 0;
                    
                    alert('Pedido finalizado com sucesso!');
                }
                
                document.getElementById('orderModal').classList.add('hidden');
                if (state.currentUser.role === 'admin') {
                    renderSales();
                }
            }
        }

        function renderProductsForAdmin() {
            elements.productsTableBody.innerHTML = '';
            
            state.products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${product.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${product.category}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">R$ ${product.price.toFixed(2).replace('.', ',')}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="edit-product text-blue-600 hover:text-blue-900 mr-3" data-id="${product.id}">Editar</button>
                        <button class="delete-product text-red-600 hover:text-red-900" data-id="${product.id}">Excluir</button>
                    </td>
                `;
                
                elements.productsTableBody.appendChild(row);
            });
            
            document.querySelectorAll('.edit-product').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }

        function saveProduct(e) {
            e.preventDefault();
            
            const productName = document.getElementById('productName').value;
            const productCategory = document.getElementById('productCategory').value;
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            
            if (productName && productCategory && !isNaN(productPrice)) {
                const newProduct = {
                    id: Date.now(),
                    name: productName,
                    category: productCategory,
                    price: productPrice
                };
                
                state.products.push(newProduct);
                saveProductsToLocalStorage();
                renderProductsForAdmin();
                
                document.getElementById('addProductModal').classList.add('hidden');
                alert('Produto adicionado com sucesso!');
            } else {
                alert('Por favor, preencha todos os campos corretamente!');
            }
        }

        function editProduct(productId) {
            const product = state.products.find(p => p.id === productId);
            
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                
                elements.productForm.removeEventListener('submit', saveProduct);
                elements.productForm.addEventListener('submit', function updateHandler(e) {
                    e.preventDefault();
                    
                    const productName = document.getElementById('productName').value;
                    const productCategory = document.getElementById('productCategory').value;
                    const productPrice = parseFloat(document.getElementById('productPrice').value);
                    
                    if (productName && productCategory && !isNaN(productPrice)) {
                        product.name = productName;
                        product.category = productCategory;
                        product.price = productPrice;
                        
                        saveProductsToLocalStorage();
                        renderProductsForAdmin();
                        
                        document.getElementById('addProductModal').classList.add('hidden');
                        alert('Produto atualizado com sucesso!');
                        
                        elements.productForm.removeEventListener('submit', updateHandler);
                        elements.productForm.addEventListener('submit', saveProduct);
                    } else {
                        alert('Por favor, preencha todos os campos corretamente!');
                    }
                });
                
                document.getElementById('addProductModal').classList.remove('hidden');
            }
        }

        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                state.products = state.products.filter(p => p.id !== productId);
                saveProductsToLocalStorage();
                renderProductsForAdmin();
                alert('Produto excluído com sucesso!');
            }
        }

        function renderUsersForAdmin() {
            elements.usersTableBody.innerHTML = '';
            
            state.users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${user.username}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${user.role === 'admin' ? 'Administrador' : 'Vendedor'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${user.active ? 'Ativo' : 'Bloqueado'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        ${user.role !== 'admin' ? `<button class="toggle-active text-blue-600 hover:text-blue-900 mr-3" data-username="${user.username}">${user.active ? 'Bloquear' : 'Desbloquear'}</button>` : ''}
                        ${user.role !== 'admin' ? `<button class="delete-user text-red-600 hover:text-red-900" data-username="${user.username}">Excluir</button>` : ''}
                    </td>
                `;
                
                elements.usersTableBody.appendChild(row);
            });
            
            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    deleteUser(username);
                });
            });

            document.querySelectorAll('.toggle-active').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    toggleUserActive(username);
                });
            });
        }

        function toggleUserActive(username) {
            const user = state.users.find(u => u.username === username);
            if (user) {
                user.active = !user.active;
                saveUsersToLocalStorage();
                renderUsersForAdmin();
            }
        }

        function saveUser(e) {
            e.preventDefault();
            
            const newUsername = document.getElementById('newUsername').value;
            const newPassword = document.getElementById('newPassword').value;
            
            if (newUsername && newPassword) {
                if (state.users.some(u => u.username === newUsername)) {
                    alert('Usuário já existe!');
                    return;
                }
                
                const newUser = {
                    username: newUsername,
                    password: newPassword,
                    role: 'vendedor',
                    active: true
                };
                
                state.users.push(newUser);
                saveUsersToLocalStorage();
                renderUsersForAdmin();
                
                document.getElementById('addUserModal').classList.add('hidden');
                alert('Usuário adicionado com sucesso!');
            } else {
                alert('Por favor, preencha todos os campos!');
            }
        }

        function deleteUser(username) {
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                state.users = state.users.filter(u => u.username !== username);
                saveUsersToLocalStorage();
                renderUsersForAdmin();
                alert('Usuário excluído com sucesso!');
            }
        }

        function renderSales() {
            if (!elements.salesTableBody) return;
            
            elements.salesTableBody.innerHTML = '';
            
            let totalPeriod = 0;
            let totalDiscount = 0;
            let totalServiceCharge = 0;
            const filteredSales = filterSales();
            
            filteredSales.forEach(sale => {
                totalPeriod += sale.total;
                totalDiscount += (sale.subtotal * (sale.discount / 100));
                totalServiceCharge += (sale.serviceChargeAmount || 0);
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const saleDate = new Date(sale.date);
                const formattedDate = saleDate.toLocaleDateString('pt-BR');
                const formattedTime = saleDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${formattedDate}</div>
                        <div class="text-sm text-gray-500">${formattedTime}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${sale.tableNumber}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900">
                            ${sale.items.map(item => `${item.quantity}x ${item.name}`).join(', ')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">R$ ${sale.subtotal.toFixed(2).replace('.', ',')}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${sale.discount}%</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">R$ ${sale.serviceChargeAmount ? sale.serviceChargeAmount.toFixed(2).replace('.', ',') : '0,00'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">R$ ${sale.total.toFixed(2).replace('.', ',')}</div>
                    </td>
                `;
                
                elements.salesTableBody.appendChild(row);
            });
            
            elements.periodTotal.textContent = `R$ ${totalPeriod.toFixed(2).replace('.', ',')}`;
            elements.periodDiscountTotal.textContent = `R$ ${totalDiscount.toFixed(2).replace('.', ',')}`;
            elements.periodServiceChargeTotal.textContent = `R$ ${totalServiceCharge.toFixed(2).replace('.', ',')}`;
        }

        function filterSales() {
            const startDateValue = elements.dateStartFilter.value;
            const endDateValue = elements.dateEndFilter.value;
            
            if (!startDateValue && !endDateValue) {
                return state.sales;
            }

            let startDate = null;
            let endDate = null;

            if (startDateValue) {
                startDate = new Date(startDateValue + 'T00:00:00');
            }
            if (endDateValue) {
                endDate = new Date(endDateValue + 'T23:59:59.999');
            }

            return state.sales.filter(sale => {
                const saleDate = new Date(sale.date);
                const normalizedSaleDate = new Date(saleDate.getFullYear(), saleDate.getMonth(), saleDate.getDate());
                
                let isAfterStartDate = true;
                if (startDate) {
                    isAfterStartDate = normalizedSaleDate >= new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
                }

                let isBeforeEndDate = true;
                if (endDate) {
                    const nextDayEndDate = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate() + 1);
                    isBeforeEndDate = normalizedSaleDate < nextDayEndDate;
                }

                return isAfterStartDate && isBeforeEndDate;
            });
        }

        function filterSalesByDateRange() {
            renderSales();
        }

        function resetDateFilter() {
            elements.dateStartFilter.value = '';
            elements.dateEndFilter.value = '';
            renderSales();
        }

        function generateSalesPDF() {
            const filteredSales = filterSales();
            const startDateValue = elements.dateStartFilter.value;
            const endDateValue = elements.dateEndFilter.value;
            
            if (filteredSales.length === 0) {
                alert('Nenhuma venda encontrada para o período selecionado!');
                return;
            }
            
            const doc = new jsPDF();
            
            let fileName = 'Relatorio_Vendas_Completo.pdf';
            if (startDateValue && endDateValue) {
                fileName = `Relatorio_Vendas_${startDateValue.replace(/-/g, '_')}_a_${endDateValue.replace(/-/g, '_')}.pdf`;
            } else if (startDateValue) {
                fileName = `Relatorio_Vendas_A_partir_de_${startDateValue.replace(/-/g, '_')}.pdf`;
            } else if (endDateValue) {
                fileName = `Relatorio_Vendas_Ate_${endDateValue.replace(/-/g, '_')}.pdf`;
            }
            
            doc.setFontSize(18);
            doc.setTextColor(40);
            doc.text('Relatório de Vendas - Barraquinha', 15, 15);
            
            doc.setFontSize(12);
            if (startDateValue && endDateValue) {
                const formattedStartDate = new Date(startDateValue).toLocaleDateString('pt-BR');
                const formattedEndDate = new Date(endDateValue).toLocaleDateString('pt-BR');
                doc.text(`Período: ${formattedStartDate} a ${formattedEndDate}`, 15, 25);
            } else if (startDateValue) {
                const formattedStartDate = new Date(startDateValue).toLocaleDateString('pt-BR');
                doc.text(`Período: A partir de ${formattedStartDate}`, 15, 25);
            } else if (endDateValue) {
                const formattedEndDate = new Date(endDateValue).toLocaleDateString('pt-BR');
                doc.text(`Período: Até ${formattedEndDate}`, 15, 25);
            } else {
                doc.text('Período: Todas as vendas', 15, 25);
            }
            
            const headers = [['Data/Hora', 'Mesa', 'Itens', 'Subtotal', 'Desconto', 'Serviço (10%)', 'Total Final']];
            const data = filteredSales.map(sale => {
                const saleDate = new Date(sale.date);
                const formattedDate = saleDate.toLocaleDateString('pt-BR');
                const formattedTime = saleDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const items = sale.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                
                return [
                    `${formattedDate}\n${formattedTime}`,
                    sale.tableNumber,
                    items,
                    `R$ ${sale.subtotal.toFixed(2).replace('.', ',')}`,
                    `${sale.discount}%`,
                    `R$ ${sale.serviceChargeAmount ? sale.serviceChargeAmount.toFixed(2).replace('.', ',') : '0,00'}`,
                    `R$ ${sale.total.toFixed(2).replace('.', ',')}`
                ];
            });
            
            const totalPeriod = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalDiscount = filteredSales.reduce((sum, sale) => sum + (sale.subtotal * (sale.discount/100)), 0);
            const totalServiceCharge = filteredSales.reduce((sum, sale) => sum + (sale.serviceChargeAmount || 0), 0);

            doc.autoTable({
                head: headers,
                body: data,
                startY: 30,
                theme: 'grid',
                headStyles: {
                    fillColor: [41, 128, 185],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                columnStyles: {
                    0: { cellWidth: 25 },
                    1: { cellWidth: 15 },
                    2: { cellWidth: 45 },
                    3: { cellWidth: 20 },
                    4: { cellWidth: 20 },
                    5: { cellWidth: 25 },
                    6: { cellWidth: 20 }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 2,
                    overflow: 'linebreak'
                },
                margin: { left: 15 }
            });
            
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.setTextColor(0);
            
            doc.setFont('helvetica', 'bold');
            doc.text(`Total de Descontos: R$ ${totalDiscount.toFixed(2).replace('.', ',')}`, 15, finalY);
            doc.text(`Total de Serviço (10%): R$ ${totalServiceCharge.toFixed(2).replace('.', ',')}`, 15, finalY + 8);
            doc.text(`Total do Período: R$ ${totalPeriod.toFixed(2).replace('.', ',')}`, 15, finalY + 16);
            
            doc.save(fileName);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            if (tab === 'products') {
                elements.adminProductsTab.classList.add('active');
                elements.productsTabContent.classList.remove('hidden');
            } else if (tab === 'tables') {
                elements.adminTablesTab.classList.add('active');
                elements.tablesTabContent.classList.remove('hidden');
            } else if (tab === 'finance') {
                elements.adminFinanceTab.classList.add('active');
                elements.financeTabContent.classList.remove('hidden');
            } else if (tab === 'users') {
                elements.adminUsersTab.classList.add('active');
                elements.usersTabContent.classList.remove('hidden');
            }
        }

        function saveProductsToLocalStorage() {
            localStorage.setItem('products', JSON.stringify(state.products));
        }

        function saveTablesToLocalStorage() {
            localStorage.setItem('tables', JSON.stringify(state.tables));
        }

        function saveSalesToLocalStorage() {
            localStorage.setItem('sales', JSON.stringify(state.sales));
        }

        function saveUsersToLocalStorage() {
            localStorage.setItem('users', JSON.stringify(state.users));
        }
    </script>
</body>
</html>